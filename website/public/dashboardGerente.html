<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Gerencial - Synkro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/dashGerente.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/sessao.js"></script>
</head>

<body onload="validarSessaoSynkro()">
    <div class="layout-principal">

        <!--Barra lateral-->
        <aside class="barra-lateral">
            <div class="logo">
                Synkro
            </div>
            <div class="perfil-usuario">
                <img src="./assets/imgs/userSynkro.webp" alt="Foto de perfil padrão">
                <div class="nome-usuario" id="nome_login">Nome Sobrenome</div>
                <div class="cargo-usuario">
                    <i class="ri-shield-user-line"></i>
                    Gerente de Infra
                </div>
                <div class="email-usuario" id="email_login">usuario.email@synkro.com</div>
            </div>
            <nav>
                <ul class="menu-links">
                    <li>
                        <a href="dashboardGerente.html" class="ativo">
                            <i class="ri-dashboard-3-line"></i>
                            Visão Geral
                        </a>
                    </li>
                    <li>
                        <a href="historico.html">
                            <i class="ri-file-add-line icon-cadastro"></i>
                            Logs e Histórico
                        </a>
                    </li>
                    <li>
                        <a href="Funcionarios.html">
                            <i class="ri-database-2-line"></i>
                            Funcionários cadastrados
                        </a>
                    </li>
                </ul>
                <button class="btn-sair" onclick="limparSessao()">
                    <i class="ri-logout-box-r-line"></i>
                    Encerrar Sessão
                </button>
            </nav>
        </aside>

        <!--conteudo principal-->
        <div class="conteudo-principal dashboard">
            <header class="visao-header">
                <h1>VISÃO ESTRATÉGICA DOS ALERTAS</h1>
                <p>Monitoramento em tempo real do status operacional da sua infraestrutura crítica (CPU, RAM, DASD).</p>
                <button class="btn-periodo">Últimos 7 dias <i class="ri-arrow-down-s-line"></i></button>
            </header>

            <section class="painel-kpis">
                <div class="kpi">
                    <span class="kpi-label">Total Alertas (7 dias)</span>
                    <span class="kpi-value azul">8/8</span>
                    <p class="kpi-descricao">Número total de alertas detectados nos últimos 7 dias.</p>
                </div>
                <div class="kpi">
                    <span class="kpi-label">Alertas de CPU (7 dias)</span>
                    <span class="kpi-value alerta">72%</span>
                    <p class="kpi-descricao">Carga média de processamento dos mainframes.</p>
                </div>
                <div class="kpi">
                    <span class="kpi-label">Alertas de RAM (7 dias)</span>
                    <span class="kpi-value verde">55%</span>
                    <p class="kpi-descricao">Percentual médio de memória utilizada.
                    </p>
                </div>
                <div class="kpi">
                    <span class="kpi-label">Alertas de Disco (7 dias)</span>
                    <span class="kpi-value roxo">85%</span>
                    <p class="kpi-descricao">Espaço de armazenamento médio ocupado.</p>
                </div>
            </section>


            <section class="painel-graficos">
                <div class="grafico grande" id="grafico-tendencia">
                    <div class="grafico-header-nav">
                        <button class="btn-nav" onclick="navegarGraficoTendencia('anterior')">&lt;</button>
                        <div class="titulo-metricas">
                            <h3>Tendência de Uso de <span id="metricaAtual">CPU e RAM</span></h3>
                            <p class="grafico-descricao" id="descricaoGraficoTendencia">Acompanhe a variação da carga
                                média de CPU e RAM para identificar picos e horários críticos.</p>
                        </div>
                        <button class="btn-nav" onclick="navegarGraficoTendencia('proximo')">&gt;</button>
                    </div>
                    <canvas id="graficoCpuRam"></canvas>
                </div>

                <div class="grafico pequeno ranking-alertas">
                    <h3>Mainframes com mais alertas</h3>
                    <ol class="lista-mainframes">
                        <li><span class="rank">1</span> Mainframe 2<strong class="vermelho">20 alertas</strong></li>
                        <li><span class="rank">2</span> Mainframe 7<strong class="vermelho">12 alertas</strong></li>
                        <li><span class="rank">3</span> Mainframe 3<strong class="vermelho">7 alertas</strong></li>
                        <li><span class="rank">4</span> Mainframe 1<strong class="vermelho">5 alertas</strong></li>
                        <li><span class="rank">5</span> Mainframe 5<strong class="vermelho">2 alertas</strong></li>
                    </ol>
                </div>

            </section>
        </div>
    </div>

    <script>
        window.chartCpuRam = null;
        window.chartCarga = null;

        const metricasTendencia = [
            { id: '7dias', titulo: 'Histórico Últimos 7 Dias', descricao: 'Acompanhe a utilização de CPU, RAM e Disco nos últimos 7 dias, identificando picos de uso e alertas frequentes.', datasets: ['cpu', 'ram', 'disco'] },
            { id: '1mes', titulo: 'Histórico Último Mês', descricao: 'Observe o comportamento do sistema no último mês, monitorando CPU, RAM e Disco para planejamento e prevenção.', datasets: ['cpu', 'ram', 'disco'] },
            { id: '1ano', titulo: 'Histórico Último Ano', descricao: 'Análise anual de CPU, RAM e Disco, ajudando a identificar padrões e otimizar a infraestrutura de forma estratégica.', datasets: ['cpu', 'ram', 'disco'] }
        ];

        let metricaAtualIndex = 0;

        const datasetFull = {
            '7dias': {
                labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
                cpu: [45, 52, 68, 80, 76, 64, 70],
                ram: [35, 40, 55, 65, 60, 50, 58],
                disco: [60, 62, 70, 75, 72, 68, 70]
            },
            '1mes': {
                labels: ['Semana 1', 'Semana 2', 'Semana 3', 'Semana 4'],
                cpu: [60, 62, 58, 65],
                ram: [50, 55, 52, 60],
                disco: [70, 72, 68, 75]
            },
            '1ano': {
                labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                cpu: [50, 55, 60, 65, 70, 72, 68, 75, 78, 80, 82, 85],
                ram: [40, 42, 45, 50, 55, 57, 52, 60, 63, 65, 68, 70],
                disco: [60, 62, 65, 68, 70, 72, 70, 75, 78, 80, 82, 85]
            }
        };

        function atualizarGraficoTendencia() {
            if (!window.chartCpuRam) return;
            const metrica = metricasTendencia[metricaAtualIndex];
            const dados = datasetFull[metrica.id];
            window.chartCpuRam.data.labels = dados.labels;
            window.chartCpuRam.data.datasets = metrica.datasets.map(id => ({
                label: `Uso de ${id.toUpperCase()} (%)`,
                data: dados[id],
                borderColor: id === 'cpu' ? '#38bdf8' : id === 'ram' ? '#22c55e' : '#a855f7',
                pointBackgroundColor: id === 'cpu' ? '#38bdf8' : id === 'ram' ? '#22c55e' : '#a855f7',
                backgroundColor: id === 'cpu' ? 'rgba(56,189,248,0.15)' : id === 'ram' ? 'rgba(34,197,94,0.15)' : 'rgba(168,85,247,0.15)',
                fill: true,
                tension: 0.3,
                borderWidth: 3,
                pointRadius: 4
            }));
            document.getElementById('metricaAtual').innerText = metrica.titulo;
            document.getElementById('descricaoGraficoTendencia').innerText = metrica.descricao;
            window.chartCpuRam.options.plugins.legend.display = metrica.datasets.length > 1;
            window.chartCpuRam.update();
        }

        function navegarGraficoTendencia(direcao) {
            if (direcao === 'proximo') {
                metricaAtualIndex = (metricaAtualIndex + 1) % metricasTendencia.length;
            } else if (direcao === 'anterior') {
                metricaAtualIndex = (metricaAtualIndex - 1 + metricasTendencia.length) % metricasTendencia.length;
            }
            atualizarGraficoTendencia();
        }

        function initCharts() {
            const canvasCpuRam = document.getElementById('graficoCpuRam');
            if (canvasCpuRam) {
                if (window.chartCpuRam) window.chartCpuRam.destroy();
                const ctxCpuRam = canvasCpuRam.getContext('2d');
                window.chartCpuRam = new Chart(ctxCpuRam, {
                    type: 'line',
                    data: {
                        labels: datasetFull[metricasTendencia[metricaAtualIndex].id].labels,
                        datasets: metricasTendencia[metricaAtualIndex].datasets.map(id => ({
                            label: `Uso de ${id.toUpperCase()} (%)`,
                            data: datasetFull[metricasTendencia[metricaAtualIndex].id][id],
                            borderColor: id === 'cpu' ? '#38bdf8' : id === 'ram' ? '#22c55e' : '#a855f7',
                            pointBackgroundColor: id === 'cpu' ? '#38bdf8' : id === 'ram' ? '#22c55e' : '#a855f7',
                            backgroundColor: id === 'cpu' ? 'rgba(56,189,248,0.15)' : id === 'ram' ? 'rgba(34,197,94,0.15)' : 'rgba(168,85,247,0.15)',
                            fill: true,
                            tension: 0.3,
                            borderWidth: 3,
                            pointRadius: 4
                        }))
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: metricasTendencia[metricaAtualIndex].datasets.length > 1,
                                labels: { color: '#cbd5e1' }
                            }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#cbd5e1' } },
                            x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#cbd5e1' } }
                        }
                    }
                });
                atualizarGraficoTendencia();
            }

            const canvasCarga = document.getElementById('graficoCarga');
            if (canvasCarga) {
                if (window.chartCarga) window.chartCarga.destroy();
                const ctxCarga = canvasCarga.getContext('2d');
                window.chartCarga = new Chart(ctxCarga, {
                    type: 'doughnut',
                    data: {
                        labels: ['MF-01', 'MF-02', 'MF-03', 'MF-04', 'MF-05', 'MF-06', 'MF-07', 'MF-08'],
                        datasets: [{
                            data: [14, 12, 17, 11, 10, 9, 14, 13],
                            backgroundColor: ['#38bdf8', '#22c55e', '#eab308', '#ef4444', '#6366f1', '#14b8a6', '#f97316', '#8b5cf6'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom', labels: { color: '#cbd5e1' } } },
                        cutout: '70%'
                    }
                });
            }
        }

        window.onload = function () {
            if (typeof validarSessaoSynkro === 'function') validarSessaoSynkro();
            initCharts();
        };
    </script>

</body>

</html>