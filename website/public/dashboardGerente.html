<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Gerencial - Synkro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/dashGerente.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/sessao.js"></script>
</head>

<body onload="validarSessaoSynkro()">
    <div class="layout-principal">

        <!--Barra lateral-->
        <aside class="barra-lateral">
            <div class="logo">
                Synkro
            </div>
            <div class="perfil-usuario">
                <img src="./assets/imgs/userSynkro.webp" alt="Foto de perfil padrão">
                <div class="nome-usuario" id="nome_login">Nome Sobrenome</div>
                <div class="cargo-usuario">
                    <i class="ri-shield-user-line"></i>
                    Gerente de Infra
                </div>
                <div class="email-usuario" id="email_login">usuario.email@synkro.com</div>
            </div>
            <nav>
                <ul class="menu-links">
                    <li>
                        <a href="dashboardGerente.html" class="ativo">
                            <i class="ri-dashboard-3-line"></i>
                            Visão Geral
                        </a>
                    </li>
                    <li>
                        <a href="historico.html">
                            <i class="ri-file-add-line icon-cadastro"></i>
                            Logs e Histórico
                        </a>
                    </li>
                    <li>
                        <a href="Funcionarios.html">
                            <i class="ri-database-2-line"></i>
                            Funcionários cadastrados
                        </a>
                    </li>
                </ul>
                <button class="btn-sair" onclick="limparSessao()">
                    <i class="ri-logout-box-r-line"></i>
                    Encerrar Sessão
                </button>
            </nav>
        </aside>

        <!--conteudo principal-->
        <div class="conteudo-principal dashboard">

            <div class="btn-periodo-container">
                <button class="btn-periodo" id="btnPeriodo">
                    Última Semana <i class="ri-arrow-down-s-line"></i>
                </button>
                <ul class="dropdown-periodo" id="dropdownPeriodo">
                    <li data-periodo="hoje">Última semana</li>
                    <li data-periodo="semana">Último mês</li>
                    <li data-periodo="mes">Último Semestre</li>
                    <li data-periodo="ano">Último Ano</li>
                </ul>
            </div>

            <!-- KPIs Principais -->
            <section class="painel-kpis-principal">
                <div class="kpi-principal">
                    <span class="kpi-label">Total de Alertas</span>
                    <span class="kpi-value azul" id="kpiTotalAlertas">46</span>
                    <p class="kpi-descricao">Número total de alertas detectados</p>
                </div>
                <div class="kpi-principal">
                    <span class="kpi-label">Mainframe Crítico</span>
                    <span class="kpi-value alerta" id="kpiMainframesCritico">MF-2</span>
                    <p class="kpi-descricao" id="kpiComponenteCritico">CPU com 25 alertas</p>
                </div>
                <div class="kpi-principal">
                    <span class="kpi-label">Taxa de Disponibilidade</span>
                    <span class="kpi-value verde" id="kpiDisponibilidade">98.5%</span>
                    <p class="kpi-descricao">Uptime da infraestrutura</p>
                </div>
            </section>

            <!-- Gráficos em duas colunas -->
            <section class="painel-graficos-novo">
                <!-- Coluna esquerda: Gráfico de Mainframes -->
                <div class="coluna-esquerda">
                    <div class="grafico grafico-mainframes">
                        <h3>Mainframes com Mais Alertas</h3>
                        <canvas id="graficoMainframes"></canvas>
                    </div>
                </div>

                <!-- Coluna direita: KPI de Pico + Gráfico Rosquinha -->
                <div class="coluna-direita">
                    <div class="kpi-pico">
                        <span class="kpi-label">Pico de Alertas</span>
                        <span class="kpi-value azul" id="kpiPico">Seg - 15 alertas</span>
                        <p class="kpi-descricao">Período com maior concentração</p>
                    </div>
                    <div class="grafico grafico-componentes">
                        <h3>Distribuição por Componente</h3>
                        <canvas id="graficoComponentes"></canvas>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        window.chartMainframes = null;
        window.chartComponentes = null;
        let periodoAtual = 'semana';

        // Dados dos períodos
        const dadosKPIs = {
            semana: { total: 46, cpu: 25, ram: 10, disco: 11, disponibilidade: 98.5 },
            mes: { total: 177, cpu: 96, ram: 36, disco: 45, disponibilidade: 97.8 },
            semestre: { total: 507, cpu: 301, ram: 86, disco: 120, disponibilidade: 99.2 },
            ano: { total: 1900, cpu: 1026, ram: 324, disco: 550, disponibilidade: 96.5 }
        };

        const dadosMainframes = {
            semana: [
                { nome: 'MF-2', alertas: 20 },
                { nome: 'MF-7', alertas: 12 },
                { nome: 'MF-3', alertas: 7 },
                { nome: 'MF-1', alertas: 5 },
                { nome: 'MF-5', alertas: 2 }
            ],
            mes: [
                { nome: 'MF-2', alertas: 60 },
                { nome: 'MF-7', alertas: 50 },
                { nome: 'MF-3', alertas: 40 },
                { nome: 'MF-1', alertas: 15 },
                { nome: 'MF-5', alertas: 12 }
            ],
            semestre: [
                { nome: 'MF-2', alertas: 200 },
                { nome: 'MF-7', alertas: 150 },
                { nome: 'MF-3', alertas: 120 },
                { nome: 'MF-1', alertas: 60 },
                { nome: 'MF-5', alertas: 40 }
            ],
            ano: [
                { nome: 'MF-2', alertas: 600 },
                { nome: 'MF-7', alertas: 550 },
                { nome: 'MF-3', alertas: 450 },
                { nome: 'MF-1', alertas: 180 },
                { nome: 'MF-5', alertas: 120 }
            ]
        };

        const dadosPico = {
            semana: { periodo: 'Dia', pico: 'Seg - 15 alertas' },
            mes: { periodo: 'Semana', pico: 'Semana 2 - 52 alertas' },
            semestre: { periodo: 'Mês', pico: 'Mar - 180 alertas' },
            ano: { periodo: 'Mês', pico: 'Nov - 248 alertas' }
        };

        const dadosComponentes = {
            semana: { cpu: 25, ram: 10, disco: 11 },
            mes: { cpu: 96, ram: 36, disco: 45 },
            semestre: { cpu: 301, ram: 86, disco: 120 },
            ano: { cpu: 1026, ram: 324, disco: 550 }
        };

        function atualizarKPIsPrincipais(periodo) {
            const kpis = dadosKPIs[periodo];
            const mainframes = dadosMainframes[periodo];
            const componenteAlerts = dadosComponentes[periodo];

            // KPI 1: Total de alertas
            document.getElementById('kpiTotalAlertas').textContent = kpis.total;

            // KPI 2: Mainframe crítico
            const mainframeCritico = mainframes[0];
            const componenteMaior = componenteAlerts.cpu > componenteAlerts.ram 
                ? (componenteAlerts.cpu > componenteAlerts.disco ? 'CPU' : 'DISCO')
                : (componenteAlerts.ram > componenteAlerts.disco ? 'RAM' : 'DISCO');
            
            document.getElementById('kpiMainframesCritico').textContent = mainframeCritico.nome;
            document.getElementById('kpiComponenteCritico').textContent = 
                `${componenteMaior} com ${mainframeCritico.alertas} alertas`;

            // KPI 3: Disponibilidade
            document.getElementById('kpiDisponibilidade').textContent = kpis.disponibilidade + '%';

            // KPI Pico
            document.getElementById('kpiPico').textContent = dadosPico[periodo].pico;
        }

        function inicializarGraficoMainframes() {
            const canvas = document.getElementById('graficoMainframes');
            if (!canvas) return;

            if (window.chartMainframes) window.chartMainframes.destroy();

            const mainframes = dadosMainframes[periodoAtual];
            const labels = mainframes.map(mf => mf.nome);
            const data = mainframes.map(mf => mf.alertas);

            const ctx = canvas.getContext('2d');
            window.chartMainframes = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Quantidade de Alertas',
                        data: data,
                        backgroundColor: [
                            '#ef4444',
                            '#f97316',
                            '#eab308',
                            '#22c55e',
                            '#06b6d4'
                        ],
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#cbd5e1' }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { color: '#cbd5e1' }
                        }
                    }
                }
            });
        }

        function inicializarGraficoComponentes() {
            const canvas = document.getElementById('graficoComponentes');
            if (!canvas) return;

            if (window.chartComponentes) window.chartComponentes.destroy();

            const componentes = dadosComponentes[periodoAtual];
            const ctx = canvas.getContext('2d');

            window.chartComponentes = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['CPU', 'RAM', 'DISCO'],
                    datasets: [{
                        data: [componentes.cpu, componentes.ram, componentes.disco],
                        backgroundColor: ['#38bdf8', '#22c55e', '#a855f7'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#cbd5e1' }
                        }
                    },
                    cutout: '70%'
                }
            });
        }

        function atualizarDashboard(periodo) {
            periodoAtual = periodo;
            atualizarKPIsPrincipais(periodo);
            inicializarGraficoMainframes();
            inicializarGraficoComponentes();
        }

        // Inicialização
        window.onload = function () {
            if (typeof validarSessaoSynkro === 'function') validarSessaoSynkro();
            atualizarDashboard('semana');
        };

        // Dropdown de período
        const btnPeriodo = document.getElementById('btnPeriodo');
        const dropdownPeriodo = document.getElementById('dropdownPeriodo');

        btnPeriodo.addEventListener('click', () => {
            dropdownPeriodo.style.display = dropdownPeriodo.style.display === 'block' ? 'none' : 'block';
        });

        dropdownPeriodo.querySelectorAll('li').forEach(item => {
            item.addEventListener('click', () => {
                const periodo = item.getAttribute('data-periodo');
                btnPeriodo.innerHTML = item.innerText + ' <i class="ri-arrow-down-s-line"></i>';
                dropdownPeriodo.style.display = 'none';
                atualizarDashboard(periodo);
            });
        });
    </script>

</body>

</html>