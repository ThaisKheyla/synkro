<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Gerencial - Synkro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/dashGerente.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/sessao.js"></script>
</head>

<body onload="validarSessaoSynkro()">
    <div class="layout-principal">
        <!--Barra lateral-->
        <aside class="barra-lateral">
            <div class="logo">Synkro</div>
            <div class="perfil-usuario">
                <img src="./assets/imgs/foto_perfil_padrao.webp" alt="Foto de perfil padrão">
                <div class="cargo-usuario">Gerente de Infra</div>
                <div class="nome-usuario" id="nome_login">Nome Sobrenome</div>
                <div class="email-usuario" id="email_login">usuario.email@synkro.com</div>
            </div>
            <nav>
                <ul class="menu-links">
                    <li><a href="dashboardGerente.html" class="ativo">Visão Geral</a></li>
                    <li><a href="historico.html">Logs e Histórico</a></li>
                    <li><a href="Funcionarios.html">Funcionários cadastrados</a></li>
                </ul>
                <button class="btn-sair" onclick="limparSessao()">Sair do Sistema</button>
            </nav>
            
        </aside>

        <!--conteudo principal-->
        <div class="conteudo-principal dashboard">
            <header class="visao-header">
                <h1>Painel de Controle: Monitoramento de Mainframes Bancários</h1>
                <p>Monitoramento em tempo real do status operacional da sua infraestrutura crítica (CPU, RAM, DASD).</p>
            </header>

            <section class="painel-kpis">
                <div class="kpi">
                    <span class="kpi-label">Mainframes Ativos</span>
                    <span class="kpi-value azul">8/8</span>
                    <p class="kpi-descricao">Total de equipamentos online.</p>
                </div>
                <div class="kpi">
                    <span class="kpi-label">Uso Médio de CPU</span>
                    <span class="kpi-value alerta">72%</span>
                    <p class="kpi-descricao">Média da carga de processamento. Requer atenção!</p>
                </div>
                <div class="kpi">
                    <span class="kpi-label">Uso Médio de RAM</span>
                    <span class="kpi-value verde">55%</span>
                    <p class="kpi-descricao">Média da utilização de memória.</p>
                </div>
                <div class="kpi">
                    <span class="kpi-label">Utilização de DASD</span>
                    <span class="kpi-value roxo">85%</span>
                    <p class="kpi-descricao">Espaço médio de armazenamento ocupado.</p>
                </div>
            </section>

            <section class="painel-graficos">
                <div class="grafico grande" id="grafico-tendencia">
                    <div class="grafico-header-nav">
                        <button class="btn-nav" onclick="navegarGraficoTendencia('anterior')">&lt;</button>
                        <div class="titulo-metricas">
                            <h3>Tendência de Uso de <span id="metricaAtual">CPU e RAM</span> (Últimas 24h)</h3>
                            <p class="grafico-descricao" id="descricaoGraficoTendencia">Acompanhe a variação da carga
                                média de CPU e RAM para identificar picos e horários críticos.</p>
                        </div>
                        <button class="btn-nav" onclick="navegarGraficoTendencia('proximo')">&gt;</button>
                    </div>
                    <canvas id="graficoCpuRam"></canvas>
                </div>

                <div class="grafico pequeno" id="grafico-carga">
                    <h3>Distribuição de Carga de CPU por Mainframe</h3>
                    <p class="grafico-descricao">Distribuição percentual da carga total de CPU entre os equipamentos.
                    </p>
                    <canvas id="graficoCarga"></canvas>
                </div>

                <div class="grafico pequeno" id="painel-alertas">
                    <h3>Alertas Críticos Recentes</h3>
                    <p class="grafico-descricao">Notificações urgentes para ação imediata.</p>
                    <div class="area-alertas">
                        <div class="alerta-card vermelho">
                            <p><strong>MF-03</strong> – Pico de CPU detectado (92%)</p>
                            <span>Há 15 min</span>
                        </div>
                        <div class="alerta-card amarelo">
                            <p><strong>MF-07</strong> – Uso de RAM elevado (88%)</p>
                            <span>Há 42 min</span>
                        </div>
                        <div class="alerta-card amarelo">
                            <p><strong>MF-07</strong> – Uso de RAM elevado (88%)</p>
                            <span>Há 42 min</span>
                        </div>
                        <div class="alerta-card amarelo">
                            <p><strong>MF-07</strong> – Uso de RAM elevado (88%)</p>
                            <span>Há 42 min</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // Variável para armazenar a instância do gráfico
        window.chartCpuRam = null;
        window.chartCarga = null;

        // Lista de métricas para o gráfico de tendência (usado pelos botões < >)
        const metricasTendencia = [
            {
                id: 'geral',
                titulo: 'CPU e RAM',
                descricao: 'Acompanhe a variação da carga média de CPU e RAM para identificar picos e horários críticos.',
                datasets: ['cpu', 'ram']
            },
            {
                id: 'cpu',
                titulo: 'CPU',
                descricao: 'Foco na tendência de utilização do processamento central (CPU) nas últimas 24 horas.',
                datasets: ['cpu']
            },
            {
                id: 'ram',
                titulo: 'RAM',
                descricao: 'Foco na tendência de utilização da memória (RAM) nas últimas 24 horas. Verifique picos de consumo.',
                datasets: ['ram']
            }
        ];
        let metricaAtualIndex = 0; // Começa em 'CPU e RAM'

        // Dados completos dos datasets para fácil acesso
        const datasetFull = {
            cpu: {
                label: 'Uso de CPU (%)',
                data: [45, 52, 68, 80, 76, 64],
                borderColor: '#38bdf8', backgroundColor: 'rgba(56,189,248,0.15)', fill: true, tension: 0.3, borderWidth: 3, pointRadius: 4, pointBackgroundColor: '#38bdf8'
            },
            ram: {
                label: 'Uso de RAM (%)',
                data: [35, 40, 55, 65, 60, 50],
                borderColor: '#22c55e', backgroundColor: 'rgba(34,197,94,0.15)', fill: false, tension: 0.3, borderWidth: 3, pointRadius: 4, pointBackgroundColor: '#22c55e'
            }
        };

        // Função para ATUALIZAR o gráfico de Tendência (navegação < >)
        function atualizarGraficoTendencia() {
            if (!window.chartCpuRam) return;

            const metrica = metricasTendencia[metricaAtualIndex];

            // 1. Atualiza Título e Descrição
            document.getElementById('metricaAtual').innerText = metrica.titulo;
            document.getElementById('descricaoGraficoTendencia').innerText = metrica.descricao;

            // 2. Atualiza Datasets
            window.chartCpuRam.data.datasets = metrica.datasets.map(id => datasetFull[id]);

            // Se for apenas CPU ou RAM, oculta a legenda, senão exibe
            window.chartCpuRam.options.plugins.legend.display = metrica.datasets.length > 1;

            window.chartCpuRam.update();
        }

        // Função de NAVEGAÇÃO (< >)
        function navegarGraficoTendencia(direcao) {
            if (direcao === 'proximo') {
                metricaAtualIndex = (metricaAtualIndex + 1) % metricasTendencia.length;
            } else if (direcao === 'anterior') {
                metricaAtualIndex = (metricaAtualIndex - 1 + metricasTendencia.length) % metricasTendencia.length;
            }

            atualizarGraficoTendencia();
        }


        // --- FUNÇÃO DE INICIALIZAÇÃO DE GRÁFICOS ---
        function initCharts() {
            // Gráfico 1 - Uso de CPU e RAM dos Mainframes (Linha)
            const canvasCpuRam = document.getElementById('graficoCpuRam');
            if (canvasCpuRam) {
                if (window.chartCpuRam) window.chartCpuRam.destroy();

                const ctxCpuRam = canvasCpuRam.getContext('2d');
                window.chartCpuRam = new Chart(ctxCpuRam, {
                    type: 'line',
                    data: {
                        labels: ['00h', '04h', '08h', '12h', '16h', '20h'],
                        datasets: metricasTendencia[metricaAtualIndex].datasets.map(id => datasetFull[id])
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: metricasTendencia[metricaAtualIndex].datasets.length > 1,
                                labels: { color: '#cbd5e1' }
                            }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#cbd5e1' } },
                            x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#cbd5e1' } }
                        }
                    }
                });
                // Garante que o estado inicial do título e descrição esteja correto
                atualizarGraficoTendencia();
            }

            // Gráfico 2 - Distribuição de Carga (Doughnut)
            const canvasCarga = document.getElementById('graficoCarga');
            if (canvasCarga) {
                if (window.chartCarga) window.chartCarga.destroy();
                const ctxCarga = canvasCarga.getContext('2d');
                window.chartCarga = new Chart(ctxCarga, {
                    type: 'doughnut',
                    data: {
                        labels: ['MF-01', 'MF-02', 'MF-03', 'MF-04', 'MF-05', 'MF-06', 'MF-07', 'MF-08'],
                        datasets: [{
                            data: [14, 12, 17, 11, 10, 9, 14, 13],
                            backgroundColor: ['#38bdf8', '#22c55e', '#eab308', '#ef4444', '#6366f1', '#14b8a6', '#f97316', '#8b5cf6'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom', labels: { color: '#cbd5e1' } } },
                        cutout: '70%'
                    }
                });
            }
        }

        // Chamada inicial simplificada
        window.onload = function () {
            // Verifica se a função de sessão existe antes de chamar
            if (typeof validarSessaoSynkro === 'function') {
                validarSessaoSynkro();
            }
            initCharts();
        };
    </script>
</body>

</html>