<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Synkro</title>
    <link rel="stylesheet" href="./css/logInSign.css">
</head>

<body>
    <div class="container">
        <div class="wallpaper">
            <img src="./assets/imgs/SYNKRO (1).png" alt="">
        </div>
        <div class="box_dados">

            <div class="titulo"><label for="">Cadastro</label></div>

            <div class="group-input">
                <label for="ipt_nome_empresarial">Nome Empresarial:</label>
                <input type="text" name="" id="ipt_nome_empresarial">
            </div>

            <div class="group-input">
                <label for="ipt_nome_representante">Nome do Representante: </label>
                <input type="text" name="" id="ipt_nome_representante">
            </div>

            <div class="group-input">
                <label for="ipt_ispb">Código ISPB </label>
                <input type="number" name="" id="ipt_ispb">
            </div>

            <div class="group-input">
                <label for="ipt_email">E-mail Corporativo:</label>
                <input type="email" name="" id="ipt_email">
            </div>
            <div class="group-input">
                <label for="ipt_status">Status Operação:</label>
                <select name="ipt_status" id="ipt_status">
                    <option value="em-operacao">Em operação</option>
                    <option value="liquidado-extrajudicialmente">Liquidado Extrajudicialmente</option>
                    <option value="liquidacao-ordinaria">Liquidação Ordinária</option>
                </select>
            </div>
            <span id="msg_erro"></span>
            <div class="group-button">
                <span>Já possui acesso? <a href="login.html">Faça login!</a></span>
                <button onclick="cadastrar()">Cadastrar</button>
            </div>
        </div>
    </div>

</body>

<script>
    function cadastrar() {
        var nomeEmpresarialVar = ipt_nome_empresarial.value;
        var nomeRepresentanteVar = ipt_nome_representante.value;
        var ispbVar = ipt_ispb.value;
        var emailVar = ipt_email.value;
        var statusOperacaoVar = ipt_status.value;

        if (
            nomeEmpresarialVar == "" ||
            nomeRepresentanteVar == "" ||
            ispbVar == "" ||
            emailVar == ""
        ) {
            // ERRO
            msg_erro.innerHTML = "Preencha todos os campos!"
        } else if (ispbVar.length != 8) {
            msg_erro.innerHTML = `Código ISPB deve ter 8 caracteres!`
        } else if (nomeEmpresarialVar.length < 10) {
            msg_erro.innerHTML = `Insira um nomeEmpresarial válido! Nome muito pequeno.`
        } else if (nomeRepresentanteVar.length < 3) {
            msg_erro.innerHTML = `Insira um nome válido! Nome muito pequeno.`
        } else if (emailVar.length < 5) {
            msg_erro.innerHTML = `Preencha um email válido! Muito pequeno.`
        } else if (!emailVar.includes("@") || !emailVar.includes(".")) {
            msg_erro.innerHTML = `Insira um e-mail válido!`
        } else {
            console.log("CADASTRO OK")
            fetch("/cadastroEmpresa/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    nomeEmpresarialServer: nomeEmpresarialVar,
                    nomeRepresentanteServer: nomeRepresentanteVar,
                    ispbServer: ispbVar,
                    emailServer: emailVar,
                    statusOperacaoServer: statusOperacaoVar
                })
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        console.log("cadastro realizado com sucesso")
                        console.log("redirecionando para tela de login")
                        setTimeout(() => {
                            window.location = "./login.html";
                        }, "1500");
                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });
        }
    }
</script>

</html>