<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Synkro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/dash.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="./js/sessao.js"></script>
</head>

<body onload="validarSessaoSynkro()">
    <div class="layout-principal">
        <aside class="barra-lateral">
            <div class="logo">Synkro</div>

            <div class="perfil-usuario">
                <img src="./assets/imgs/foto_perfil_padrao.webp" alt="Foto de perfil">
                <div class="cargo-usuario">Analista</div>
                <div class="nome-usuario" id="nome_login"></div>
                <div class="email-usuario" id="email_login"></div>
            </div>

            <nav>
                <ul>
                    <li><a href="#" class="btn-adicionar-componente">Informações gerais</a></li>
                    <li><a href="#" class="btn-adicionar-componente">Informações sobre o mainframe</a></li>
                </ul>

                <button class="btn-adicionar-componente" onclick="window.location.href='CadastroMainframe.html';">
                    Adicionar Mainframe
                </button>

                <!-- Botão de sair (redireciona para a página inicial)-->
                <button class="btn-sair" onclick="limparSessao()">Sair</button>
            </nav>
        </aside>

        <!-- Conteúdo principal -->
        <main class="conteudo-principal">
            <section class="painel-hardware">



                <!-- Título geral -->
                <header style="margin-bottom: 28px;">
                    <h1 style="font-size: 1.8em; font-weight: 700; color: #071026; margin-bottom: 8px;">
                        Visão estratégica de infraestrutura
                    </h1>
                    <p style="color: #666; font-size: 1em; margin: 0;">
                        Acompanhe em tempo real o uso de <strong>CPU</strong>, <strong>Memória RAM</strong> e
                        <strong>Disco</strong> dos mainframes cadastrados.
                    </p>
                </header>

                <!-- Cards de resumo -->
                <div class="cartoes-resumo">
                    <div class="cartao-resumo">
                        <div class="rotulo">Nº de incidentes críticos (total todos mainframes)</div>
                        <div id="cpuValue" class="valor">05</div>
                    </div>
                    <div class="cartao-resumo">
                        <div class="rotulo">Tempo médio para resolução - MTTR (média todos os mainframes)</div>
                        <div id="diskValue" class="valor">12 Horas</div>
                    </div>
                </div>

                <!-- Gráficos -->
                <h3 style="font-size: 1.2em; font-weight: 600; color: #2563eb; margin-bottom: 12px;">Histórico médio de
                    incidentes por mês (todos os mainframes)</h3>
                <div class="graficos-row">
                    <div class="grafico-box">
                        <h4>CPU - Uso (%)</h4>
                        <canvas id="cpuChart" width="260" height="120"></canvas>
                    </div>

                </div>

                <!-- Alertas e status -->
                <div class="alertas-status-row">
                    <div class="alertas">
                        <div class="alertas-header">
                            <h3>Insights</h3>
                            <a class="ver-tudo" href="#">Ver todos</a>
                        </div>
                        <ul class="lista-alertas">
                            <li class="alerta alerta-alta">
                                <div class="alerta-text">Mainframes X e Y estão com crescimento de uso acima de 20% nos
                                    últimos 30 dias.<span class="time">— agora
                                    </span></div>
                            </li>
                            <li class="alerta alerta-alta">
                                <div class="alerta-text">Mainframes X e Y estão com crescimento de uso acima de 20% nos
                                    últimos 30 dias.<span class="time">— 2 minutos atrás
                                    </span></div>
                            </li>
                            <li class="alerta alerta-alta">
                                <div class="alerta-text">Mainframes X e Y estão com crescimento de uso acima de 20% nos
                                    últimos 30 dias.<span class="time">— 10 minutos atrás
                                    </span></div>
                            </li>

                        </ul>
                    </div>
                </div>

            </section>
            <!-- Mainframes -->
            <!--
            <div class="mainframe-evento offline">

            -->

            <div class="widget widget-tempo">
                <h3>Tempo para resolução do alerta</h3>
                <ul>
                    <li><span class="alert-id">Alerta: 001</span><span class="tempo badge">1h</span></li>
                    <li><span class="alert-id">Alerta: 002</span><span class="tempo badge">2h</span></li>
                    <li><span class="alert-id">Alerta: 003</span><span class="tempo badge">8h</span></li>
                    <li><span class="alert-id">Alerta: 003</span><span class="tempo badge">8h</span></li>
                </ul>
            </div>
            <aside class="mainframes-cadastrados">
                <h4>Mainframes Cadastrados</h4>
                <a href="mainframe1.html" class="página de mainframe">
                    <div class="mainframe-evento offline">
                        <div class="mainframe-numero">1</div>
                        <div class="mainframe-desc">Mainframe 1</div>
                    </div>
                </a>

                <a href="mainframe2.html" class="página de mainframe">
                    <div class="mainframe-evento warning">
                        <div class="mainframe-numero">2</div>
                        <div class="mainframe-desc">Mainframe 2</div>
                    </div>
                </a>

                <a href="mainframe5.html" class="página de mainframe">
                    <div class="mainframe-evento">
                        <div class="mainframe-numero">3</div>
                        <div class="mainframe-desc">Mainframe 3</div>
                    </div>
                </a>

                <a href="mainframe4.html" class="página de mainframe">
                    <div class="mainframe-evento">
                        <div class="mainframe-numero">4</div>
                        <div class="mainframe-desc">Mainframe 4</div>
                    </div>
                </a>

                <a href="mainframe5.html" class="página de mainframe">
                    <div class="mainframe-evento">
                        <div class="mainframe-numero">5</div>
                        <div class="mainframe-desc">Mainframe 5</div>
                    </div>
                </a>
            </aside>
        </main>
    </div>
</body>

</html>

<script>
    /* ==== SEUS GRÁFICOS ==== */
    const cpuCtx = document.getElementById('cpuChart').getContext('2d');

    const cpuChart = new Chart(cpuCtx, {
        type: 'line',
        data: {
            labels: ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00'],
            datasets: [{
                label: 'CPU (%)',
                data: [20, 35, 30, 40, 38, 45, 35],
                borderColor: '#2563eb',
                backgroundColor: 'rgba(37,99,235,0.08)',
                fill: true,
                tension: 0.4,
                pointRadius: 3
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, max: 100 } }
        }
    });

    /* ====== ANIMAÇÃO ALEATÓRIA DOS DASHBOARDS ====== */
    function rnd(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

    function shiftAndPush(arr, value) {
        const copy = arr.slice();
        copy.shift();
        copy.push(value);
        return copy;
    }

    function updateChartsAndValues() {
        // CPU: gerar novo valor entre 10 e 95
        const cpuNew = rnd(10, 95);
        const cpuData = cpuChart.data.datasets[0].data;
        cpuChart.data.datasets[0].data = shiftAndPush(cpuData, cpuNew);
        cpuChart.update();
    }

    const ANIMATION_INTERVAL = 3000;
    setInterval(updateChartsAndValues, ANIMATION_INTERVAL);

    // executar imediatamente
    setTimeout(updateChartsAndValues, 600);
</script>