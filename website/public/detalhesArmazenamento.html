<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Storage - Synkro</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Roboto:wght@400;500;700&display=swap"
        rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet" />
    <link rel="stylesheet" href="./css/dashMainframes.css" />
    <link rel="stylesheet" href="./css/componentes/kpis.css" />
    <link rel="stylesheet" href="./css/componentes/status-cabecalho.css" />
    <link rel="stylesheet" href="./css/componentes/dashboards-storage.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="./js/sessao.js"></script>
    <style>
        .status-conteudo {
            position: relative;
        }

        .btn-voltar {
            position: absolute;
            right: 12px;
            top: 12px;
            background: rgba(99, 102, 241, 0.08);
            border: 1px solid rgba(99, 102, 241, 0.22);
            color: rgba(226, 232, 240, 0.95);
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            backdrop-filter: blur(6px);
        }

        .btn-voltar:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 18px rgba(16, 24, 40, 0.25);
        }

        .btn-voltar:active {
            transform: translateY(0);
        }

        /* Alert / MAC styling */
        .alerta {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid transparent;
        }

        .alerta .alerta-text {
            display: flex;
            gap: 8px;
            align-items: center;
            color: rgba(226, 232, 240, 0.9);
        }

        .mac-badge {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', 'Segoe UI Mono', monospace;
            background: rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.06);
            color: rgba(226, 232, 240, 0.95);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.4px;
        }

        .mac-label {
            color: rgba(226, 232, 240, 0.6);
            font-size: 13px;
        }

        .alerta-status {
            font-weight: 700;
            color: rgba(226, 232, 240, 0.9);
            margin-left: 6px;
        }
    </style>
</head>

<body onload="window.onload && window.onload()">
    <div class="layout-principal">
        <aside class="barra-lateral">
            <div class="logo">Synkro</div>

            <div class="perfil-usuario">
                <img src="./assets/imgs/userSynkro.webp" alt="Foto de perfil padrão" />
                <div class="nome-usuario" id="nome_login">Nome Sobrenome</div>
                <div class="cargo-usuario">
                    <i class="ri-shield-user-line"></i>
                    Analista
                </div>
                <div class="email-usuario" id="email_login">
                    usuario.email@synkro.com
                </div>
            </div>
            <nav>
                <ul class="menu-links">
                    <li>
                        <a href="dashboardAnalista.html">
                            <i class="ri-dashboard-3-line"></i>
                            Visão Geral
                        </a>
                    </li>
                    <li>
                        <a href="CadastroMainframe.html">
                            <i class="ri-file-add-line icon-cadastro"></i>
                            Cadastrar Mainframes
                        </a>
                    </li>
                    <li>
                        <a href="detalhesMainframe.html" class="ativo">
                            <i class="ri-database-2-line"></i>
                            Mainframes
                        </a>
                    </li>
                </ul>
                <button class="btn-sair" onclick="limparSessao()">
                    <i class="ri-logout-box-r-line"></i>
                    Encerrar Sessão
                </button>
            </nav>
        </aside>

        <main class="conteudo-dashboard">
            <div class="status-cabecalho">
                <div class="status-conteudo">
                    <div class="titulo-conteudo">
                        <i class="ri-pulse-line"></i>
                        <span>MONITORAMENTO DE ARMAZENAMENTO</span>
                    </div>
                    <div class="alertas-container">
                        <div class="alerta alerta-emergencia">
                            <i class="ri-alert-line"></i>
                            <div class="alerta-text">
                                <span id="mainframe-alerta-nome">Mainframe 01:</span>
                                <span class="mac-label">MAC</span>
                                <span id="mainframe-alerta-mac" class="mac-badge">00:1B:44:11:3A:B7</span>
                                <span id="mainframe-alerta-status" class="alerta-status"></span>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-voltar" onclick="voltarParaMainframe()"
                        aria-label="Voltar para lista de mainframes">← Voltar</button>
                </div>
            </div>

            <!-- Lista de Mainframes -->
            <div class="mainframes-list" id="mainframes-cad">
            </div>

            <div class="dashboard-tabs">
                <button class="tab-btn ativo" onclick="mostrarDashboard('visao-geral')">
                    <i class="ri-dashboard-2-line"></i> Visão Geral <span id="mainfrane-title"></span>
                </button>
            </div>

            <div class="dashboard-content ativo" id="dashboard-visao-geral">
                <div class="titulo-descricao">
                    <p class="texto-descricao">
                        Dashboard em tempo real com métricas críticas de performance
                    </p>
                </div>


                <!-- layout -->
                <div class="layout">
                    <div class="div-principal">
                        <div class="indicador-saude">
                            <div class="texto">
                                <div class="titulo">Estado de Ocupação</div>
                                <div class="subtitulo">Capacidade total do disco</div>
                            </div>

                            <div class="alerta">
                                <span>MUITO URGENTE</span>
                            </div>
                        </div>

                        <!-- Métricas de Uso -->
                        <div class="metricas-uso">
                            <div class="bloco">
                                <div class="rotulo">Ocupado</div>
                                <div class="valor ocupado">78%</div>
                            </div>

                            <div class="divisor"></div>

                            <div class="bloco">
                                <div class="rotulo">Livre</div>
                                <div class="valor livre">22%</div>
                            </div>

                            <div class="divisor"></div>

                            <div class="bloco">
                                <div class="rotulo">Total</div>
                                <div class="valor total">100%</div>
                            </div>
                        </div>


                        <!-- Chart -->
                        <div class="grafico-espaco">
                            <canvas id="espacoChart"></canvas>
                        </div>

                    </div>

                    <!-- KPI limite critico -->
                    <div class="limite-critico">
                        <div class="decoracao"></div>
                        <div class="cabecalho">
                            <div>
                                <div class="titulo">Limite Crítico</div>
                                <div class="dias">~18d</div>
                            </div>
                            <div class="urgencia">
                                <div class="icone">
                                    <i class="ri-time-line"></i>
                                </div>
                            </div>
                        </div>
                        <div class="conteudo">
                            <div class="descricao">Estimativa para o nível máximo de ocupação</div>
                        </div>
                    </div>

                    <!-- Métrica 2: Taxa de crescimento/dia -->
                    <div class="taxa-diaria">
                        <div class="decoracao"></div>
                        <div class="cabecalho">
                            <div>
                                <div class="titulo">Taxa Diária</div>
                                <div class="valor">+15%</div>
                            </div>
                            <div class="urgencia">
                                <div class="icone">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                                        stroke="rgba(99,102,241,1)" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <polyline points="12 5 19 12 12 19"></polyline>
                                        <polyline points="5 12 12 5 19 12"></polyline>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="conteudo">
                            <div class="acao">
                                <i class="ri-arrow-right-line"></i>Crescimento médio diário com base no dia anterior
                            </div>
                        </div>
                    </div>


                    <!-- Métrica: Crescimento histórico (30 dias) -->
                    <div class="crescimento-historico">
                        <div class="decoracao"></div>
                        <div class="cabecalho">
                            <div>
                                <div class="titulo">Ocupação a cada 1 minutos</div>
                            </div>
                            <div class="resumos">

                                <div class="resumo">
                                    <div class="resumo-label">Pico atual</div>
                                    <div class="resumo-valor">74.2%</div>
                                </div>
                            </div>
                        </div>
                        <div class="grafico">
                            <canvas id="growthTrendLine"></canvas>
                        </div>
                    </div>

                    <!-- Métrica 3: Latência -->
                    <div class="latencia">
                        <div class="decoracao"></div>
                        <div class="cabecalho">
                            <div>
                                <div class="titulo">Latência</div>
                                <div class="valor">18.5ms</div>
                            </div>
                            <div class="status">
                                <div class="icone">
                                    <i class="ri-timer-flash-line"></i>
                                </div>
                            </div>
                        </div>
                        <div class="conteudo">
                            <div class="acao">
                                <i class="ri-check-line"></i>Valor máximo registrado • Crítico &gt;25ms
                            </div>
                        </div>
                    </div>


                    <!-- Métrica 4: IOPS -->
                    <div class="iops">
                        <div class="decoracao"></div>
                        <div class="cabecalho">
                            <div>
                                <div class="titulo">IOPS Pico</div>
                                <div class="valor">4.2K</div>
                            </div>
                            <div class="status">
                                <div class="icone">
                                    <i class="ri-speed-line"></i>
                                </div>
                            </div>
                        </div>
                        <div class="conteudo">
                            <div class="acao">
                                <i class="ri-arrow-right-line"></i>Operações I/O por minuto • Capacidade ótima
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="./js/dashboards-storage.js"></script>
</body>
<script>
    let armazenamentoDados = {};
    let mainframeAtualId = 0;
    let espacoChart = null;
    let growthChart = null;
    let updateInterval = null;

    // ===== COLORS =====
    const primaryColor = "rgba(124, 58, 237, 1)";
    const secondaryColor = "rgba(16, 185, 129, 1)";
    const tertiaryColor = "rgba(99, 102, 241, 1)";
    const accentColor = "rgba(236, 72, 153, 1)";
    const grayColor = "rgba(255, 255, 255, 0.04)";
    const fontColor = "rgba(226, 232, 240, 0.95)";
    const gridColor = "rgba(255, 255, 255, 0.06)";

    const tooltipOptions = {
        backgroundColor: "rgba(6, 10, 18, 0.95)",
        titleColor: fontColor,
        bodyColor: fontColor,
        borderColor: "rgba(255, 255, 255, 0.1)",
        borderWidth: 1,
        cornerRadius: 8,
        padding: 12,
    };

    // ===== BUSCAR DADOS DO JSON =====
    async function buscarJsonArmazenamento() {
        try {
            const resposta = await fetch(`/s3Route/dados/detalhesArmazenamento.json`);
            const data = await resposta.json();
            console.log("Dados de Armazenamento (completo):", data);

            let empresaId = sessionStorage.ID_EMPRESA_USUARIO;
            let mainframeMac = sessionStorage.getItem('MAINFRAME_MAC');
            let mainframeNome = sessionStorage.getItem('MAINFRAME_NOME');

            if (empresaId !== undefined && empresaId !== null) {
                const n = Number(empresaId);
                if (!Number.isNaN(n)) empresaId = n;
            }

            // Buscar empresa no array consolidado
            let empresa = null;
            if (data.empresas && Array.isArray(data.empresas)) {
                empresa = data.empresas.find(item => item.empresa == empresaId);
                if (!empresa) {
                    console.warn(`Empresa ${empresaId} não encontrada. Usando primeira empresa.`);
                    empresa = data.empresas[0];
                }
            }

            if (!empresa || !Array.isArray(empresa.mainframes)) {
                console.error('Estrutura de dados inválida em detalhesArmazenamento.json');
                return false;
            }

            console.log(`Empresa encontrada: ${empresa.empresa} | Total de mainframes: ${empresa.mainframes.length}`);

            // Se houver MAC selecionado, filtrar apenas esse mainframe
            if (mainframeMac) {
                const mainframeEncontrado = empresa.mainframes.find(mf => mf.mac === mainframeMac);
                if (mainframeEncontrado) {
                    armazenamentoDados = [mainframeEncontrado];
                    console.log(`Filtrando por MAC: ${mainframeMac}. Mainframe encontrado:`, mainframeEncontrado);
                    if (mainframeNome) {
                        document.getElementById("mainfrane-title").innerText = mainframeNome;
                    }
                } else {
                    console.warn(`MAC ${mainframeMac} não encontrado. Exibindo todos os mainframes da empresa.`);
                    armazenamentoDados = empresa.mainframes.slice();
                }
            } else {
                armazenamentoDados = empresa.mainframes.slice();
            }

            console.log("Dados carregados para exibição:", armazenamentoDados);
            return true;
        } catch (error) {
            console.error("Erro ao buscar dados de armazenamento:", error);
            return false;
        }
    }

    function renderMainframesList() {
        const container = document.getElementById("mainframes-cad");
        container.innerHTML = "";

        // Se houver apenas 1 mainframe (veio de detalhesMainframe), não mostrar lista
        if (armazenamentoDados.length === 1 && sessionStorage.getItem('MAINFRAME_MAC')) {
            container.style.display = "none";
            return;
        }

        container.style.display = "block";
    }

    // ===== FUNÇÃO PARA DETERMINAR STATUS DE ALERTA =====
    function determinarStatusAlerta(ocupacao, min, max) {
        // Calcular percentual da ocupação em relação ao max (0-100%)
        const percentualDoMax = (ocupacao / max) * 100;

        // Definir status baseado na proximidade do máximo (ignorar min)
        if (percentualDoMax >= 85) {
            return { status: "Emergência", cor: "#ef4444", bgCor: "rgba(239, 68, 68, 0.1)" };
        } else if (percentualDoMax >= 70) {
            return { status: "Muito Urgente", cor: "#f97316", bgCor: "rgba(249, 115, 22, 0.1)" };
        } else if (percentualDoMax >= 60) {
            return { status: "Urgente", cor: "#eab308", bgCor: "rgba(234, 179, 8, 0.1)" };
        } else {
            return { status: "Normal", cor: "#10b981", bgCor: "rgba(16, 185, 129, 0.1)" };
        }
    }

    // ===== ATUALIZAR GRÁFICOS E MÉTRICAS =====
    function atualizarGraficosComDados(id) {
        const dados = armazenamentoDados[id];

        const nomeMainframe = `${dados.fabricante} ${dados.modelo}`;
        const statusAlerta = determinarStatusAlerta(dados.uso_disco_percentual, dados.min, dados.max);

        document.getElementById("mainfrane-title").innerText = nomeMainframe;
        document.getElementById("mainframe-alerta-nome").innerText = `${nomeMainframe}:`;
        document.getElementById("mainframe-alerta-mac").innerText = dados.mac;

        // Atualizar status de alerta no cabeçalho
        const alertaContainer = document.querySelector(".alerta-emergencia");
        if (alertaContainer) {
            alertaContainer.style.borderColor = statusAlerta.cor;
            alertaContainer.style.backgroundColor = statusAlerta.bgCor;
        }
        const alertaStatusElem = document.getElementById("mainframe-alerta-status");
        if (alertaStatusElem) {
            alertaStatusElem.textContent = statusAlerta.status;
            alertaStatusElem.style.color = statusAlerta.cor;
        }

        // Atualizar status de alerta dentro do .indicador-saude
        const alertaIndicador = document.querySelector(".indicador-saude .alerta");
        if (alertaIndicador) {
            const alertaSpan = alertaIndicador.querySelector("span");
            if (alertaSpan) {
                alertaSpan.textContent = statusAlerta.status;
                alertaSpan.style.color = statusAlerta.cor;
            }
            alertaIndicador.style.borderColor = statusAlerta.cor;
            alertaIndicador.style.backgroundColor = statusAlerta.bgCor;
        }

        document.querySelector(".indicador-saude .titulo").textContent = `Estado de Ocupação`;
        const ocupado = dados.uso_disco_percentual || 0;
        const livre = 100 - ocupado;
        document.querySelector(".metricas-uso .bloco:nth-child(1) .valor").textContent = ocupado.toFixed(2) + "%";
        document.querySelector(".metricas-uso .bloco:nth-child(3) .valor").textContent = livre.toFixed(2) + "%";

        const diasAte95 = dados.dias_ate_95pct ? dados.dias_ate_95pct.toFixed(0) : "N/A";
        const crescDiario = dados.crescimento_diario_pct ? Math.abs(dados.crescimento_diario_pct).toFixed(2) : "0.00";

        document.querySelector(".limite-critico .dias").textContent = `~${diasAte95}d`;
        document.querySelector(".taxa-diaria .valor").textContent = `+${crescDiario}%`;
        document.querySelector(".latencia .valor").textContent = `${(Number(dados.latencia_ms) || 0).toFixed(1)}ms`;
        // Formatar IOPS: mostrar em inteiro se <1000, ou em K se >=1000
        const picoIops = Number(dados.pico_iops) || 0;
        const totalIops = Number(dados.iops_total) || 0;
        const displayIops = picoIops >= 1000 ? `${(picoIops / 1000).toFixed(1)}K` : `${picoIops}`;

        document.querySelector(".iops .valor").textContent = `${displayIops} IOPS`;
        const iopsAux = document.querySelector(".iops .conteudo .acao");
        if (iopsAux) {
            iopsAux.textContent = `Total IOPS: ${totalIops} • Pico: ${picoIops}`;
        }

        const picoAtual = dados.historico_disco && dados.historico_disco.length > 0 ? Math.max(...dados.historico_disco) : 0;
        document.querySelector(".resumo-valor").textContent = picoAtual.toFixed(1) + "%";

        if (espacoChart) espacoChart.destroy();
        if (growthChart) growthChart.destroy();

        criarGraficoEspaco(dados);
        criarGraficoCrescimento(dados);
    }

    // ===== CRIAR GRÁFICO DE ESPAÇO =====
    function criarGraficoEspaco(dados) {
        const espacoCtx = document.getElementById("espacoChart");
        if (!espacoCtx) return;

        const ctx = espacoCtx.getContext("2d");
        const percentualLivre = 100 - dados.uso_disco_percentual;

        espacoChart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: ["Uso"],
                datasets: [
                    {
                        label: "Ocupado (%)",
                        data: [dados.uso_disco_percentual],
                        backgroundColor: "rgba(245, 158, 11, 0.8)",
                        borderColor: "rgba(245, 158, 11, 0.6)",
                        borderWidth: 2,
                        borderRadius: 6,
                        borderSkipped: false,
                        barPercentage: 1.0,
                        categoryPercentage: 0.7,
                    },
                    {
                        label: "Disponível (%)",
                        data: [percentualLivre],
                        backgroundColor: "rgba(16, 185, 129, 0.8)",
                        borderColor: "rgba(16, 185, 129, 0.6)",
                        borderWidth: 1.5,
                        borderRadius: 6,
                        borderSkipped: false,
                        barPercentage: 1.0,
                        categoryPercentage: 0.7,
                    },
                ],
            },
            options: {
                indexAxis: "y",
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                        max: 100,
                        grid: { color: "rgba(236, 72, 153, 0.06)", drawBorder: false },
                        ticks: {
                            color: "rgba(226,232,240,0.7)",
                            font: { size: 10, weight: "600" },
                            callback: function (value) {
                                return value + "%";
                            },
                        },
                    },
                    y: {
                        grid: { display: false, drawBorder: false },
                        ticks: {
                            color: "rgba(226,232,240,0.7)",
                            font: { size: 11, weight: "600" },
                        },
                    },
                },
                plugins: {
                    legend: {
                        position: "top",
                        labels: {
                            color: "rgba(226,232,240,0.8)",
                            font: { size: 11, weight: "600" },
                            padding: 12,
                            usePointStyle: true,
                            pointStyle: "circle",
                        },
                    },
                    tooltip: Object.assign({}, tooltipOptions, {
                        callbacks: {
                            label: function (context) {
                                return (
                                    context.dataset.label +
                                    ": " +
                                    (context.parsed.x || 0).toFixed(1) +
                                    "%"
                                );
                            },
                        },
                    }),
                },
            },
        });
    }

    // ===== CRIAR GRÁFICO DE CRESCIMENTO =====
    function criarGraficoCrescimento(dados) {
        const growthTrendCtx = document.getElementById("growthTrendLine");
        if (!growthTrendCtx) return;

        const ctx = growthTrendCtx.getContext("2d");
        const gradient = ctx.createLinearGradient(0, 0, 0, growthTrendCtx.height || 200);
        gradient.addColorStop(0, "rgba(99, 102, 241, 0.4)");
        gradient.addColorStop(0.5, "rgba(99, 102, 241, 0.15)");
        gradient.addColorStop(1, "rgba(99, 102, 241, 0.01)");

        // Gerar labels em minutos (ex: "Agora", "1min atrás", "2min atrás", etc) - até 60 minutos
        const labels = [];
        if (dados.historico_disco && dados.historico_disco.length > 0) {
            for (let i = 0; i < dados.historico_disco.length; i++) {
                if (i === 0) {
                    labels.push("Agora");
                } else if (i % 10 === 0) {
                    // Mostrar cada 10 minutos
                    labels.push(`${i}m`);
                } else {
                    labels.push(i.toString()); // Mostrar número do minuto mesmo sem texto
                }
            }
        } else {
            labels = Array.from({ length: 60 }, (_, i) => i === 0 ? "Agora" : (i % 10 === 0 ? `${i}m` : i.toString()));
        }

        growthChart = new Chart(ctx, {
            type: "line",
            data: {
                labels: labels,
                datasets: [
                    {
                        label: "Ocupação (%)",
                        data: dados.historico_disco || [],
                        borderColor: "rgba(99, 102, 241, 1)",
                        backgroundColor: gradient,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.45,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: "rgba(6, 10, 18, 1)",
                        pointBorderWidth: 2.5,
                        pointBorderColor: "rgba(99, 102, 241, 1)",
                    },
                ],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: "nearest", intersect: false },
                scales: {
                    x: {
                        grid: {
                            color: "rgba(99, 102, 241, 0.08)",
                            drawBorder: false,
                            drawTicks: false,
                        },
                        ticks: {
                            color: "rgba(226,232,240,0.6)",
                            font: { size: 10, weight: "600" },
                        },
                    },
                    y: {
                        min: 0,
                        max: 100,
                        grid: {
                            color: "rgba(99, 102, 241, 0.06)",
                            borderDash: [6, 4],
                            drawBorder: false,
                        },
                        ticks: {
                            color: "rgba(226,232,240,0.6)",
                            font: { size: 10, weight: "600" },
                            callback: function (value) {
                                return value + "%";
                            },
                            padding: 8,
                        },
                    },
                },
                plugins: {
                    legend: { display: false },
                    tooltip: Object.assign({}, tooltipOptions, {
                        callbacks: {
                            label: function (context) {
                                return (context.parsed.y || 0).toFixed(1) + " %";
                            },
                        },
                    }),
                },
            },
        });
    }

    function voltarParaMainframe() {
        sessionStorage.removeItem('MAINFRAME_MAC');
        sessionStorage.removeItem('MAINFRAME_NOME');
        window.location.href = 'detalhesMainframe.html';
    }

    function atualizarDadosPeriodicamente() {
        updateInterval = setInterval(() => {
            atualizarGraficosComDados(mainframeAtualId);
        }, 3000); // A cada 3 segundos
    }

    // ===== CARREGAR DADOS NA INICIALIZAÇÃO =====
    window.onload = () => {
        validarSessaoSynkro();
        buscarJsonArmazenamento().then((sucesso) => {
            if (sucesso) {
                renderMainframesList();
                atualizarGraficosComDados(mainframeAtualId);
                atualizarDadosPeriodicamente();
            }
        });
    };

    // ===== PROJECTION LINE (Projeção próximos 30 dias) - Enhanced =====
    const projectionCtx = document.getElementById("projectionLine");
    if (projectionCtx) {
        const ctx = projectionCtx.getContext("2d");
        const gradientProj = ctx.createLinearGradient(
            0,
            0,
            0,
            projectionCtx.height || 200
        );
        gradientProj.addColorStop(0, "rgba(245, 158, 11, 0.4)");
        gradientProj.addColorStop(0.5, "rgba(245, 158, 11, 0.15)");
        gradientProj.addColorStop(1, "rgba(245, 158, 11, 0.01)");

        new Chart(ctx, {
            type: "line",
            data: {
                labels: ["Hoje", "D+5", "D+10", "D+15", "D+20", "D+25", "D+30"],
                datasets: [
                    {
                        label: "Projeção (TB)",
                        data: [14.2, 14.4, 14.6, 14.8, 15.0, 15.2, 15.4],
                        borderColor: "rgba(245, 158, 11, 1)",
                        backgroundColor: gradientProj,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.45,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: "rgba(6, 10, 18, 1)",
                        pointBorderWidth: 2.5,
                        pointBorderColor: "rgba(245, 158, 11, 1)",
                        borderDash: [6, 3],
                    },
                ],
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: "nearest", intersect: false },
                scales: {
                    x: {
                        grid: {
                            color: "rgba(245, 158, 11, 0.08)",
                            drawBorder: false,
                            drawTicks: false,
                        },
                        ticks: {
                            color: "rgba(226,232,240,0.6)",
                            font: { size: 10, weight: "600" },
                        },
                    },
                    y: {
                        min: 13.5,
                        max: 18,
                        grid: {
                            color: "rgba(245, 158, 11, 0.06)",
                            borderDash: [6, 4],
                            drawBorder: false,
                        },
                        ticks: {
                            color: "rgba(226,232,240,0.6)",
                            font: { size: 10, weight: "600" },
                            callback: function (value) {
                                return value + " TB";
                            },
                            padding: 8,
                        },
                    },
                },
                plugins: {
                    legend: { display: false },
                    tooltip: Object.assign({}, tooltipOptions, {
                        callbacks: {
                            label: function (context) {
                                return (
                                    "Projeção: " + (context.parsed.y || 0).toFixed(1) + " TB"
                                );
                            },
                        },
                    }),
                },
            },
        });
    }
</script>

</html>